<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rajshree Punjab Lottery (Local)</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0e0e0f; --card:#141415; --muted:#6e6e72; --gold:#ffcf33;
  --gold-2:#ffbf00; --warn:#e85d5d; --accent:#2a2a2f; --tableRow:#1b1b1f;
  --stroke:#29292d; --radius:18px;
}
*{box-sizing:border-box;}
html,body{height:100%; margin:0; font-family:'Montserrat',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif; color:#fff; background:var(--bg);}
header{position:sticky; top:0; background:linear-gradient(180deg,#0f0f11 0%,#0c0c0d 100%); border-bottom:1px solid #19191c; padding:12px 14px; text-align:center; font-weight:700; color:#eaeaea; letter-spacing:.3px;}
.wrap{max-width:760px;margin:0 auto;padding:14px;}
.card{background:var(--card); border:1px solid var(--stroke); border-radius:var(--radius); padding:16px; box-shadow:0 8px 30px rgba(0,0,0,.45);}
.title{font-size:26px; line-height:1.2; font-weight:800; color:var(--gold); text-shadow:0 1px 0 #000;}
.sub{margin-top:4px; color:#c6c6c9; font-size:13px;}
.meta{display:flex; align-items:center; justify-content:space-between; margin:12px 0 8px; color:#cfcfd4; font-size:12px;}
.countdown{text-align:center; font-weight:800; letter-spacing:2px; font-size:46px; color:var(--warn); margin:10px 0 14px; text-shadow:0 0 20px rgba(232,93,93,.35);}
.abc{display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:8px;}
.tile{position:relative; background:linear-gradient(180deg,#141415 0%,#121213 100%); border:2px solid var(--gold-2); border-radius:16px; height:96px; display:flex; align-items:center; justify-content:center; box-shadow:0 6px 24px rgba(255,191,0,.25);}
.tile .label{position:absolute; top:8px; left:10px; font-size:13px; color:#9c8a3d; font-weight:800; letter-spacing:.4px;}
.tile .value{font-size:34px; font-weight:900; color:var(--gold); text-shadow:0 1px 0 #000, 0 0 14px rgba(255,207,51,.35);}
.tile.flash{animation:pop .65s ease;}
@keyframes pop{0%{transform:scale(1)}35%{transform:scale(1.08)}100%{transform:scale(1)}}
nav.tabs{display:flex; gap:8px; margin-bottom:10px;}
nav.tabs button{padding:10px 12px; border-radius:10px; border:1px solid #2c2c30; background:#19191c; color:#d6d6da; font-weight:700; cursor:pointer;}
nav.tabs button.active{background:#221d0f; color:#ffcf33; border-color:#4a3a12;}
.table{overflow:auto; border-radius:12px; border:1px solid var(--stroke); margin-top:10px;}
table{width:100%; border-collapse:collapse; min-width:480px;}
th,td{padding:12px 10px; text-align:center;}
thead th{background:#201f22; color:#d9d9dd; font-weight:800; font-size:13px; border-bottom:1px solid var(--stroke);}
tbody tr{ background:var(--tableRow); border-bottom:1px solid #222329;}
tbody tr:nth-child(even){ background:#15161a; }
tbody td{ color:#d6d6da; font-weight:600; }
tr.live{ outline:2px solid rgba(255,207,51,.5); position:relative; }
tr.live td{ color:#ffda58; }
.admin-list{display:flex;flex-direction:column;gap:10px; max-height:60vh; overflow:auto;}
.admin-item{display:grid;grid-template-columns:72px repeat(3,1fr);gap:8px; align-items:center; background:#121214; border:1px solid #2a2a2f; border-radius:12px; padding:10px;}
.admin-time{font-weight:900;color:#ffda58;text-align:center}
.admin-actions{display:flex; gap:10px; margin-top:12px; justify-content:flex-end;}
.btn{padding:10px 14px; border-radius:10px; border:1px solid #2c2c30; background:#19191c; color:#e9e9ee; font-weight:800; cursor:pointer;}
.btn.gold{ background:#221d0f; color:#ffcf33; border-color:#4a3a12; } .btn.gold:hover{ filter:brightness(1.1) }
.btn.danger{ background:#211416; color:#ff9c9c; border-color:#3a2020; }
@media (min-width:768px){ .title{font-size:30px} .countdown{font-size:52px} .tile{height:104px} }

/* Message Box Styles */
.message-box {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--card);
  border: 1px solid var(--stroke);
  border-radius: var(--radius);
  padding: 20px;
  box-shadow: 0 8px 30px rgba(0,0,0,.6);
  z-index: 1000;
  display: none;
  flex-direction: column;
  align-items: center;
  gap: 15px;
  text-align: center;
  max-width: 80%;
}
.message-box p {
  margin: 0;
}
.message-box .close-btn {
  background: var(--gold);
  color: var(--bg);
  padding: 8px 16px;
  border-radius: 8px;
  border: none;
  font-weight: bold;
  cursor: pointer;
}
</style>
</head>
<body>
<header>Rajshree Punjab Lottery</header>
<div class="wrap">
<nav class="tabs" style="justify-content:center">
  <button id="tab-live" class="active" onclick="showTab('live')">Live</button>
  <button id="tab-admin" onclick="showTab('admin')">Admin</button>
</nav>

<!-- LIVE -->
<section id="live" class="card">
  <div class="title">Rajshree Punjab Lottery</div>
  <div class="sub">15-Minute Draws • Live Results (9 AM – 9 PM)</div>
  <div class="meta">
    <div id="dateNow">--/--/---- | --:--:--</div>
    <div id="windowNow">Next: <span id="nextSlot">--:--</span></div>
  </div>
  <div id="countdown" class="countdown">00 : 00</div>
  <div class="abc">
    <div class="tile"><span class="label">A</span><span class="value" id="valA">--</span></div>
    <div class="tile"><span class="label">B</span><span class="value" id="valB">--</span></div>
    <div class="tile"><span class="label">C</span><span class="value" id="valC">--</span></div>
  </div>
  <div class="table">
    <table>
      <thead><tr><th>Time</th><th>A</th><th>B</th><th>C</th></tr></thead>
      <tbody id="tbodyToday"></tbody>
    </table>
  </div>
</section>

<!-- ADMIN -->
<section id="admin" class="card" style="display:none">
  <div id="adminLogin" style="display:flex; gap:8px; align-items:center; margin:8px 0 14px;">
    <input id="adminPass" type="password" placeholder="Enter password">
    <button class="btn gold" onclick="checkLogin()">Login</button>
  </div>
  <div id="adminPanel" style="display:none">
    <div class="admin-list" id="adminList"></div>
    <div class="admin-actions">
      <button class="btn gold" onclick="saveAdmin()">Save</button>
      <button class="btn danger" onclick="resetToday()">Reset Today</button>
      <button class="btn" onclick="exportCSV()">Export CSV</button>
      <button class="btn" onclick="logoutAdmin()">Logout</button>
    </div>
  </div>
</section>
</div>

<!-- Custom Message Box -->
<div id="messageBox" class="message-box">
  <p id="messageText"></p>
  <button class="close-btn" onclick="closeMessageBox()">OK</button>
</div>

<script>
  let drawsToday = [];
  const DRAW_START = 9, DRAW_END = 21, SLOT_MIN = 15;
  const adminPassword = "admin123";
  const LOCAL_STORAGE_KEY = 'lottery_draws';

  // Utility function to pad numbers with a leading zero
  const pad2 = n => String(n).padStart(2, '0');

  // Function to show a custom message box
  function showMessageBox(message) {
    const msgBox = document.getElementById('messageBox');
    const msgText = document.getElementById('messageText');
    msgText.textContent = message;
    msgBox.style.display = 'flex';
  }

  // Function to close the custom message box
  function closeMessageBox() {
    const msgBox = document.getElementById('messageBox');
    msgBox.style.display = 'none';
  }

  // Generate an array of lottery draw slots for the day
  function generateDraws() {
    console.log("Generating new draws for the day.");
    const newDraws = [];
    const now = new Date();
    const dateStr = now.toISOString().split('T')[0];

    for (let h = DRAW_START; h < DRAW_END; h++) {
        for (let m = 0; m < 60; m += SLOT_MIN) {
            newDraws.push({
                date: dateStr,
                time: pad2(h) + ":" + pad2(m),
                A: String(Math.floor(Math.random() * 100)).padStart(2, '0'),
                B: String(Math.floor(Math.random() * 100)).padStart(2, '0'),
                C: String(Math.floor(Math.random() * 100)).padStart(2, '0')
            });
        }
    }
    return newDraws;
  }
  
  // Save the draws to local storage
  function saveDrawsToStorage() {
      const data = {
          date: new Date().toISOString().split('T')[0],
          draws: drawsToday
      };
      localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));
      console.log("Draws saved to local storage.");
  }

  // Load draws from local storage
  function loadDrawsFromStorage() {
      const storedData = localStorage.getItem(LOCAL_STORAGE_KEY);
      if (storedData) {
          const data = JSON.parse(storedData);
          const todayDateStr = new Date().toISOString().split('T')[0];
          // Check if the stored data is from today
          if (data.date === todayDateStr) {
              drawsToday = data.draws;
              console.log("Draws loaded from local storage.");
              return true;
          }
      }
      console.log("No draws found for today in local storage. Starting fresh.");
      return false;
  }

  // Check login logic
  function checkLogin() {
    const pass = document.getElementById('adminPass').value;
    if (pass === adminPassword) {
      document.getElementById('adminLogin').style.display = 'none';
      document.getElementById('adminPanel').style.display = 'block';
      populateAdmin();
    } else {
      showMessageBox("Wrong password! Please try again.");
    }
  }

  // Admin panel population
  function populateAdmin() {
    const list = document.getElementById('adminList');
    list.innerHTML = '';
    drawsToday.forEach((slot, i) => {
      const div = document.createElement('div');
      div.className = 'admin-item';
      div.innerHTML = `
        <div class="admin-time">${slot.time}</div>
        <input type="text" value="${slot.A}" id="inputA${i}" maxlength="2" inputmode="numeric" pattern="[0-9]*">
        <input type="text" value="${slot.B}" id="inputB${i}" maxlength="2" inputmode="numeric" pattern="[0-9]*">
        <input type="text" value="${slot.C}" id="inputC${i}" maxlength="2" inputmode="numeric" pattern="[0-9]*">
      `;
      list.appendChild(div);
    });
  }

  // Save admin changes and update local storage
  function saveAdmin() {
    drawsToday.forEach((slot, i) => {
      const inputA = document.getElementById(`inputA${i}`);
      const inputB = document.getElementById(`inputB${i}`);
      const inputC = document.getElementById(`inputC${i}`);
      slot.A = inputA.value.padStart(2, '0');
      slot.B = inputB.value.padStart(2, '0');
      slot.C = inputC.value.padStart(2, '0');
    });
    saveDrawsToStorage();
    showMessageBox("Saved! Changes will be reflected live and will persist until the next day.");
  }

  // Reset today's draws locally
  function resetToday() {
    drawsToday = generateDraws();
    saveDrawsToStorage();
    showMessageBox("Today's draws have been reset.");
    populateAdmin();
    updateLive();
  }

  // Export CSV function
  function exportCSV() {
    let csv = "date,time,A,B,C\n";
    drawsToday.forEach(d => csv += `${d.date},${d.time},${d.A},${d.B},${d.C}\n`);
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'draws.csv';
    a.click();
  }

  function logoutAdmin() {
    document.getElementById('adminPanel').style.display = 'none';
    document.getElementById('adminLogin').style.display = 'flex';
    document.getElementById('adminPass').value = '';
  }

  function showTab(tab) {
    document.getElementById('live').style.display = tab === 'live' ? 'block' : 'none';
    document.getElementById('admin').style.display = tab === 'admin' ? 'block' : 'none';
    document.getElementById('tab-live').classList.toggle('active', tab === 'live');
    document.getElementById('tab-admin').classList.toggle('active', tab === 'admin');
    
    if (tab === 'admin') {
      if (document.getElementById('adminPanel').style.display === 'block') {
          populateAdmin();
      }
    }
  }

  function updateLive() {
    const now = new Date();
    document.getElementById('dateNow').textContent = now.toLocaleString();
    const currMinutes = now.getHours() * 60 + now.getMinutes();

    let nextSlotObj = null;
    for (const slot of drawsToday) {
      const [h, m] = slot.time.split(':').map(Number);
      if (h * 60 + m > currMinutes) {
        nextSlotObj = slot;
        break;
      }
    }

    if (nextSlotObj) {
      const [h, m] = nextSlotObj.time.split(':').map(Number);
      const nextDate = new Date();
      nextDate.setHours(h);
      nextDate.setMinutes(m);
      nextDate.setSeconds(0);
      nextDate.setMilliseconds(0);
      const diff = Math.max(0, (nextDate - now) / 1000);
      const mins = Math.floor(diff / 60), secs = Math.floor(diff % 60);
      document.getElementById('countdown').textContent = `${pad2(mins)} : ${pad2(secs)}`;
      document.getElementById('nextSlot').textContent = nextSlotObj.time;
    } else {
      document.getElementById('countdown').textContent = '-- : --';
      document.getElementById('nextSlot').textContent = '--';
    }

    const liveSlot = drawsToday.find(slot => {
      const [h, m] = slot.time.split(':').map(Number);
      const currentSlotMinutes = Math.floor(now.getMinutes() / SLOT_MIN) * SLOT_MIN;
      return now.getHours() === h && currentSlotMinutes === m;
    });

    document.getElementById('valA').textContent = liveSlot ? liveSlot.A : '--';
    document.getElementById('valB').textContent = liveSlot ? liveSlot.B : '--';
    document.getElementById('valC').textContent = liveSlot ? liveSlot.C : '--';

    populateTodayTable();
  }

  function populateTodayTable() {
    const tbody = document.getElementById('tbodyToday');
    tbody.innerHTML = '';
    const now = new Date();
    const currMinutes = now.getHours() * 60 + now.getMinutes();
    drawsToday.forEach(slot => {
      const [h, m] = slot.time.split(':').map(Number);
      const slotMinutes = h * 60 + m;
      if (slotMinutes <= currMinutes) {
        const tr = document.createElement('tr');
        if (slotMinutes === Math.floor(currMinutes / SLOT_MIN) * SLOT_MIN) tr.className = 'live';
        tr.innerHTML = `<td>${slot.time}</td><td>${slot.A}</td><td>${slot.B}</td><td>${slot.C}</td>`;
        tbody.appendChild(tr);
      }
    });
  }

  window.onload = function() {
    // Attempt to load draws from local storage.
    const isLoaded = loadDrawsFromStorage();
    if (!isLoaded) {
      // If no data or data is old, generate a new set of draws and save them.
      drawsToday = generateDraws();
      saveDrawsToStorage();
    }
    setInterval(updateLive, 1000);
  }

  // Expose functions to the global scope
  window.checkLogin = checkLogin;
  window.saveAdmin = saveAdmin;
  window.resetToday = resetToday;
  window.exportCSV = exportCSV;
  window.logoutAdmin = logoutAdmin;
  window.showTab = showTab;
  window.closeMessageBox = closeMessageBox;

</script>
</body>
</html>
